Scheme = 'CriticalMaps'
Scheme_UnitTests = 'CriticalMapsTests'
Scheme_UITests = 'CriticalMapsUITests'
Scheme_SnapshotTests = 'CriticalMapsSnapshotTests'

Screenshots_Output = 'build/screenshots' 

AppIdentifier = 'de.pokuslabs.criticalmassberlin'

skip_docs

default_platform(:ios)

platform :ios do

  desc 'Run unit tests'
  lane :test do
    run_tests(
      device: 'iPhone 12',
      scheme: Scheme_UnitTests,
      result_bundle: true
    )
    trainer(path: "./fastlane/test_output", output_directory: "./fastlane")
  end

  desc 'Run snapshot tests'
  lane :snapshot_test do
    run_tests(
      scheme: Scheme_SnapshotTests,
      device: "iPhone 8",
      result_bundle: true
    )
    trainer(path: "./fastlane/test_output", output_directory: "./fastlane")
  end

  desc 'Run UITests'
  lane :ui_test do
    capture_ios_screenshots(
      app_identifier: AppIdentifier,
      configuration: 'Debug',
      output_directory: Screenshots_Output,
      scheme: Scheme_UITests,
      languages: [ "en-US" ],
      devices: [ "iPhone 8" ]
    )
  end
  
  desc 'Make screenshots with all languages and different devices'
  lane :screenshots_complete do
    capture_ios_screenshots(
      app_identifier: AppIdentifier,
      configuration: 'Debug',
      output_directory: Screenshots_Output,
      scheme: Scheme_UITests,
      languages: [ "en-US",
                   "de-DE",
                    "fr-FR",
                    "it-IT"],
      devices: [ "iPhone 8",
            "iPhone 8 Plus",
                "iPhone SE",
                 "iPhone X",
        "iPhone 11 Pro Max"]
    )
  end

  desc 'Make screenshots in English and iPhone 8'
  lane :screenshots_limited do
    capture_ios_screenshots(
      app_identifier: AppIdentifier,
      configuration: 'Debug',
      output_directory: Screenshots_Output,
      scheme: Scheme_UITests,
      languages: [ "en-US" ],
      devices: [ "iPhone 8" ]
    )
  end
end
